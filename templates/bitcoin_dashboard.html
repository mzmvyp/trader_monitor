<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Data Dashboard</title>
</head>
<body>
    <h1>Bitcoin Data Dashboard</h1>
    <p><a href="/">Back to Main Dashboard</a></p>

    <h2>Stream Control</h2>
    <button onclick="startStream()">Start Bitcoin Stream</button>
    <button onclick="stopStream()">Stop Bitcoin Stream</button>
    <p>Status: <span id="stream-status-text">Loading...</span></p>

    <h2>Recent Bitcoin Data</h2>
    <pre id="bitcoin-data">Loading recent data...</pre>

    <h2>Bitcoin Metrics (Last 30 Min)</h2>
    <pre id="bitcoin-metrics">Loading metrics...</pre>

    <script>
        async function fetchStreamStatus() {
            try {
                const response = await fetch('/bitcoin/api/stream-status');
                const data = await response.json();
                document.getElementById('stream-status-text').textContent = data.is_running ? 'Running' : 'Stopped';
            } catch (error) {
                document.getElementById('stream-status-text').textContent = 'Error';
                console.error('Error fetching stream status:', error);
            }
        }

        async function startStream() {
            try {
                const response = await fetch('/bitcoin/api/start-stream', { method: 'POST' });
                const data = await response.json();
                alert(data.message);
                fetchStreamStatus(); // Update status after action
            } catch (error) {
                alert('Error starting stream: ' + error);
                console.error('Error starting stream:', error);
            }
        }

        async function stopStream() {
            try {
                const response = await fetch('/bitcoin/api/stop-stream', { method: 'POST' });
                const data = await response.json();
                alert(data.message);
                fetchStreamStatus(); // Update status after action
            } catch (error) {
                alert('Error stopping stream: ' + error);
                console.error('Error stopping stream:', error);
            }
        }

        async function fetchRecentBitcoinData() {
            try {
                const response = await fetch('/bitcoin/api/recent-data?limit=10');
                const data = await response.json();
                document.getElementById('bitcoin-data').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('bitcoin-data').textContent = 'Error loading recent data: ' + error;
                console.error('Error fetching recent data:', error);
            }
        }

        async function fetchBitcoinMetrics() {
            try {
                const response = await fetch('/bitcoin/api/metrics?time_window_minutes=30');
                const data = await response.json();
                document.getElementById('bitcoin-metrics').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('bitcoin-metrics').textContent = 'Error loading metrics: ' + error;
                console.error('Error fetching metrics:', error);
            }
        }

        fetchStreamStatus();
        fetchRecentBitcoinData();
        fetchBitcoinMetrics();

        setInterval(fetchRecentBitcoinData, 5000); // Update every 5 seconds
        setInterval(fetchBitcoinMetrics, 15000); // Update every 15 seconds
        setInterval(fetchStreamStatus, 10000); // Update stream status every 10 seconds
    </script>
</body>
</html>